################################# HK Graph Tree with Cleora + LSH Settings  #################################
# 基础配置 (Basic Configuration)
use_entities_vdb: True                     # 是否启用实体向量数据库，用于实体相似性检索
use_relations_vdb: False                   # 是否启用关系向量数据库，高级检索时可设为True
llm_model_max_token_size: 32768           # LLM模型最大token限制，控制输入文本长度
use_entity_link_chunk: True               # 启用实体-块链接映射，支持HK图的实体溯源功能
enable_graph_augmentation: False          # 启用图增强，通过实体相似性添加额外连边(hipporag)

# 数据配置 (Data Configuration)
index_name: hk_graph_tree_cleora_lsh      # 索引名称，用于标识当前实验配置

vdb_type: faiss  # vector/colbert

token_model: gpt-3.5-turbo

# 文档分块配置 (Chunk Configuration)
chunk:
  chunk_token_size: 1200                   # 每个文档块的token大小，影响图构建的粒度
  chunk_overlap_token_size: 100            # 相邻文档块之间的重叠token数，确保信息连续性
  chunk_method: chunking_by_token_size     # 分块方法：基于token数量进行分块

# 图构建配置 (Graph Configuration)
graph:
    # 图构建基础设置
    enable_entity_description: True          # 启用实体描述生成，增强实体语义表示
    graph_type: hk_graph_tree                # 图类型：hk_graph_tree - 层次化混合知识图
    force: False                             # 是否强制重建图，False时会复用已有图
    
    # HK图特定配置 (HK Graph Specific Configurations)
    # 实体关系抽取设置
    extract_two_step: True                   # 启用两步抽取：先NER命名实体识别，再OpenIE开放信息抽取
    max_gleaning: 1                          # 最大信息收集轮数，控制抽取迭代次数
    enable_entity_type: True                 # 启用实体类型标注，如人名、地名、组织等
    enable_edge_description: True            # 启用关系边的描述生成
    enable_edge_name: True                   # 启用关系边的名称标注
    
    # 段落级实体链接设置
    use_wat_linking: False                   # 是否使用WAT实体链接系统连接到Wikipedia
    prior_prob: 0.8                         # 实体链接的最小概率阈值，高于此值才建立链接
    
    # Cleora嵌入配置 (Cleora Embedding Configuration)
    cleora_dim: 1024                          # Cleora嵌入维度
    cleora_iterations: 2                     # Cleora迭代次数，控制邻居信息聚合深度
    
    # LSH聚类配置 (LSH Clustering Configuration)
    lsh_num_hyperplanes: 16 #16                  # LSH超平面数量，影响哈希精度
    lsh_min_cluster_size: 5                  # LSH聚类最小大小
    lsh_max_cluster_size: 50                 # LSH聚类最大大小
    
    # 层次化配置 (Hierarchical Configuration)
    max_hierarchy_levels: 4                  # 最大层次级别
    community_summary_length: 300           # 社区摘要最大长度
    random_seed: 42                          # 随机种子，确保结果可复现
    
    # 通用设置
    summary_max_tokens: 500                  # 实体/关系摘要的最大token数
    llm_model_max_token_size: 32768         # 图构建阶段LLM的最大token限制
    
    # Chunk-Chunk连接设置
    shared_entity_threshold: 3  #1             # 建立chunk-chunk连接所需的最小共享实体数量
    
    # FAISS向量索引配置 (FAISS Vector Index Configuration)
    faiss_index_type: HNSW                     # FAISS索引类型选项：
                                               # - HNSW: HNSW+L2距离(快速，距离越小越相似)
                                               # - HNSW_IP: HNSW+内积(快速，分数越大越相似)  
                                               # - FLAT: 暴力搜索+内积(精确，分数越大越相似)
                                               # - FLAT_L2: 暴力搜索+L2距离(精确，距离越小越相似)
    faiss_hnsw_m: 64                           # HNSW算法M参数，控制连接度(提高质量)
    faiss_hnsw_ef_construction: 500            # HNSW构建时的efConstruction参数
    faiss_hnsw_ef_search: 200                   # HNSW搜索时的efSearch参数
    faiss_index_path: "./faiss_index_debug/quality"     # FAISS索引保存路径

# 检索器配置 (Retrieval Configuration)
retriever:
    query_type: hk_tree                      # 检索类型：使用HKGraphTree层次化检索方法
    
    # 层次化检索设置 (Hierarchical Retrieval Settings)
    enable_hierarchical_retrieval: True     # 启用层次化检索
    hierarchy_search_levels: 3              # 搜索的层次级别数
    community_boost_factor: 1.2             # 社区节点权重提升因子
    hk_tree_retrieval_method: hk_tree_flat_search  # 检索策略: hk_tree_search, hk_tree_top_down, hk_tree_comprehensive, hk_tree_true_search, hk_tree_flat_search
    
    # 树搜索特定设置 (Tree Search Specific Settings)
    top_k: 5                               # 每层返回的顶部结果数量
    max_communities_per_level: 5            # 每层最大社区数量
    max_expansion_depth: 3                   # 最大展开深度
    community_relevance_threshold: 0.3      # 社区相关性阈值
    
    # PPR兼容设置（用于回退）
    enable_local: False                      # 是否启用局部检索模式
    use_entity_similarity_for_ppr: False     # PPR中是否使用实体相似性权重
    top_k_entity_for_ppr: 8                 # PPR算法中的种子实体数量，影响检索范围
    node_specificity: True                   # 启用节点特异性权重，常见实体权重较低
    damping: 0.1                            # PPR阻尼因子，控制随机游走的重启概率
    
    # 真正的树搜索设置（类似EraRAG LSH）
    # custom_search: True                       # 启用自定义树搜索
    # portion: 0.8                            # 叶子节点比例（80%叶子节点，20%非叶子节点）
    
    # 上下文token限制
    max_token_for_local_context: 4000       # 局部上下文的最大token数
    max_token_for_global_context: 8000      # 全局上下文的最大token数
    
    # 实体和关系的token限制
    entities_max_tokens: 2000               # 实体信息的最大token数
    relationships_max_tokens: 2000          # 关系信息的最大token数

# 查询配置 (Query Configuration)
query: 
    query_type: qa                           # 查询类型：qa(问答) 或 summary(摘要)
    only_need_context: False                 # 是否只返回上下文，不进行LLM生成
    enable_hybrid_query: True                # 启用混合查询，结合多种检索策略
    level: 2                                 # 查询复杂度级别，影响检索深度
    top_k: 5                                # 候选结果数量，优化为5以提高精度
    k_nei: 3                                # k邻居数量，用于图遍历
    
    # 层次化查询设置 (Hierarchical Query Settings)
    enable_community_context: True          # 启用社区上下文
    community_context_levels: 3             # 社区上下文层级数
    hk_tree_retrieval_method: hk_tree_flat_search  # 检索策略配置
    enable_entity_extraction: True          # 启用查询实体提取
    
    # 树搜索查询设置 (Tree Search Query Settings)
    tree_search: True                        # 启用树搜索
    max_tree_search_depth: 3                # 最大树搜索深度
    tree_search_breadth: 5                  # 树搜索广度（每层节点数）
    
    # IR-CoT 迭代推理链配置 (兼容性保留)
    enable_ir_cot: True                      # 启用IR-CoT迭代推理链，提升多跳推理能力
    max_ir_steps: 2                         # 最大迭代推理步数，建议2-3步
    ir_cot_top_k: 5                         # IR-CoT中每轮使用的文档数量
    
    # 上下文设置 (Context Settings)
    retrieve_top_k: 5                        # 最终检索返回的结果数量，优化为5
    naive_max_token_for_text_unit: 12000     # 朴素检索模式下文本单元的最大token数
    local_max_token_for_text_unit: 4000      # 局部检索模式下文本单元的最大token数
    max_token_for_text_unit: 4000           # 标准检索模式下文本单元的最大token数
    
    # 结果限制设置 (Result Limitation Settings)
    max_communities_in_context: 1           # 上下文中最大社区数量
    max_entities_in_context: 5              # 上下文中最大实体数量
    max_relationships_in_context: 5         # 上下文中最大关系数量
    max_chunks_in_context: 5                # 上下文中最大文档块数量
    
    entities_max_tokens: 2000               # 查询阶段实体信息的最大token数
    relationships_max_tokens: 2000          # 查询阶段关系信息的最大token数
    
    # 文档显示控制设置 (Document Display Control Settings)
    max_document_display_length: 8000       # 允许完整显示的文档最大长度（字符数）
    max_smart_truncate_length: 8000         # 启用智能截断的阈值长度（字符数）
    truncate_head_chars: 4000                # 截断时保留的开头字符数
    truncate_tail_chars: 3000                # 截断时保留的结尾字符数